<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rental Management App</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React Libraries -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel to transpile JSX in the browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        /* Simple style overrides */
        body {
            font-family: 'Inter', sans-serif;
        }
        .form-checkbox, .form-radio {
            color: #4f46e5;
        }
        @media print {
            body * {
                visibility: hidden;
            }
            #printable-quotation, #printable-quotation * {
                visibility: visible;
            }
            #printable-quotation {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                border: none !important;
                color: black !important;
            }
            #printable-quotation .bg-gray-800 {
                background-color: white !important;
            }
            #printable-quotation .text-white {
                color: black !important;
            }
             #printable-quotation .text-gray-300, #printable-quotation .text-gray-400, #printable-quotation .text-indigo-400 {
                color: #555 !important;
            }
            #printable-quotation .border-gray-700 {
                border-color: #ccc !important;
            }
             #printable-quotation .bg-gray-900 {
                background-color: #f0f0f0 !important;
            }
        }
    </style>
     <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-900">
    <div id="root"></div>

    <script type="text/babel">
        // --- SVG Icons (replaces lucide-react for standalone use) ---
        const HomeIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>;
        const ShoppingCartIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/></svg>;
        const HeartIcon = ({ filled }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill={filled ? "currentColor" : "none"} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>;
        const UserIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>;
        const SearchIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>;
        const StarIcon = ({ filled }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill={filled ? "currentColor" : "none"} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>;
        const ChevronDownIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="6 9 12 15 18 9"/></svg>;
        const GridIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>;
        const ListIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg>;
        const PlusIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>;
        const MinusIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="5" y1="12" x2="19" y2="12"/></svg>;
        const Trash2Icon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>;
        const CheckIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"/></svg>;
        const EyeIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>;
        const EyeOffIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/></svg>;
        const DownloadIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>;


        // --- MOCK DATABASE & CONFIG ---
        const initialProducts = [
            { id: 1, name: 'Professional DSLR Camera', category: 'Electronics', price: 150, rating: 4.8, purchaseCount: 120, dateAdded: '2025-07-15', imageUrl: 'https://images.unsplash.com/photo-1519638831568-d9897f54ed69?ixlib=rb-4.0.3&q=85&fm=jpg&crop=entropy&cs=srgb&w=600', color: 'Black', description: 'High-end DSLR camera, perfect for professional photography and videography. Comes with a standard 18-55mm lens. Capture stunning images with 24.2MP sensor.', priceList: { hour: 20, day: 150, week: 600, month: 2000 }, terms: 'Standard rental T&Cs apply.', pickupAddress: '123 Tech Lane, Silicon Valley, CA' },
            { id: 2, name: 'Camping Tent - 4 Person', category: 'Outdoor Gear', price: 50, rating: 4.5, purchaseCount: 250, dateAdded: '2025-06-20', imageUrl: 'https://images.unsplash.com/photo-1504280390367-361c6d9f38f4?ixlib=rb-4.0.3&q=85&fm=jpg&crop=entropy&cs=srgb&w=600', color: 'Green', description: 'Durable and waterproof 4-person tent. Easy to set up and ideal for weekend camping trips. Provides excellent ventilation and protection from the elements.', priceList: { hour: 5, day: 50, week: 200, month: 700 }, terms: 'Cleaning fee applies if returned dirty.', pickupAddress: '456 Adventure Ave, Boulder, CO' },
            { id: 3, name: 'Electric Mountain Bike', category: 'Sports Equipment', price: 80, rating: 4.9, purchaseCount: 95, dateAdded: '2025-08-01', imageUrl: 'https://images.unsplash.com/photo-1575585252319-38ABC17c5147?ixlib=rb-4.0.3&q=85&fm=jpg&crop=entropy&cs=srgb&w=600', color: 'Red', description: 'Powerful electric mountain bike with a 50-mile range. Tackle any terrain with ease. Features front suspension and durable all-terrain tires.', priceList: { hour: 10, day: 80, week: 400, month: 1500 }, terms: 'Helmet and lock included.', pickupAddress: '789 Trail Head, Moab, UT' },
        ];
        let mockUsers = [
            { email: 'adam@example.com', password: 'password123', name: 'Adam', role: 'customer', phone: '9876543210' },
            { email: 'lender@example.com', password: 'password123', name: 'Lender Pro', role: 'lender', phone: '9988776655' },
        ];
        let mockContactSubmissions = [];
        const categories = ['All', 'Electronics', 'Outdoor Gear', 'Sports Equipment', 'Tools'];
        const colors = ['Black', 'Green', 'Red', 'White', 'Blue', 'Yellow'];
        const TAX_RATE = 0.05;
        const DELIVERY_CHARGE = 50;

        // --- CONTEXT API FOR GLOBAL STATE ---
        const AppContext = React.createContext();

        const AppProvider = ({ children }) => {
            const [page, setPage] = React.useState('login');
            const [user, setUser] = React.useState(null);
            const [products, setProducts] = React.useState(initialProducts);
            const [quotations, setQuotations] = React.useState([]);
            const [selectedProduct, setSelectedProduct] = React.useState(null);
            const [selectedQuotation, setSelectedQuotation] = React.useState(null);
            const [cart, setCart] = React.useState([]);
            const [wishlist, setWishlist] = React.useState([]);
            
            const navigate = (newPage, data = null) => {
                if (newPage === 'productDetail') setSelectedProduct(data);
                if (newPage === 'quotationDetail' || newPage === 'payment') setSelectedQuotation(data);
                setPage(newPage);
            };

            // --- Auth Functions ---
            const login = (email, password, role) => {
                const foundUser = mockUsers.find(u => u.email === email && u.password === password && u.role === role);
                if (foundUser) {
                    setUser(foundUser);
                    navigate(foundUser.role === 'lender' ? 'lenderDashboard' : 'shop');
                    return true;
                }
                return false;
            };

            const register = (name, email, phone, password) => {
                if (mockUsers.some(u => u.email === email)) return false;
                const newUser = { email, password, name, phone, role: 'customer' };
                mockUsers.push(newUser);
                setUser(newUser);
                navigate('shop');
                return true;
            };
            
            const updateUser = (updatedDetails, successMessage) => {
                setUser(prevUser => ({...prevUser, ...updatedDetails}));
                mockUsers = mockUsers.map(u => u.email === user.email ? {...u, ...updatedDetails} : u);
                alert(successMessage);
                navigate(user.role === 'lender' ? 'lenderDashboard' : 'shop');
            };
            
            const resetPassword = (email, newPassword) => {
                const userExists = mockUsers.some(u => u.email === email);
                if (!userExists) return false;
                mockUsers = mockUsers.map(u => u.email === email ? {...u, password: newPassword} : u);
                return true;
            };

            const logout = () => {
                setUser(null);
                setCart([]);
                setWishlist([]);
                navigate('login');
            };
            
            const addContactSubmission = (submission) => {
                mockContactSubmissions.push(submission);
                console.log("Current Contact Submissions:", mockContactSubmissions);
                alert("Thank you for your message! We will get back to you shortly.");
                navigate(user ? 'shop' : 'login');
            };

            // --- Wishlist Functions ---
            const toggleWishlist = (product) => {
                setWishlist(prev => {
                    const isInWishlist = prev.some(p => p.id === product.id);
                    if (isInWishlist) return prev.filter(p => p.id !== product.id);
                    return [...prev, product];
                });
            };

            // --- Cart & Quotation Functions ---
            const addToCart = (item) => {
                setCart(prev => {
                    const existing = prev.find(i => i.product.id === item.product.id);
                    if (existing) {
                        return prev.map(i => i.product.id === item.product.id ? { ...i, quantity: item.quantity, from: item.from, to: item.to } : i);
                    }
                    return [...prev, item];
                });
            };
            
            const requestQuotation = (requestData) => {
                const quotation = {
                    id: `QUO-${Date.now()}`,
                    customer: user,
                    ...requestData,
                    orderDate: new Date().toISOString().split('T')[0],
                    expiryDate: new Date(Date.now() + 3 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                    status: 'Pending' // Initial status for lender
                };
                setQuotations(prev => [...prev, quotation]);
                console.log("Quotations:", [...quotations, quotation]);
                setCart([]);
                alert(`Quotation ${quotation.id} has been requested successfully! The lender will respond shortly.`);
                navigate('customerOrders');
            };

            const updateQuotationStatus = (quotationId, newStatus) => {
                setQuotations(prevQuotations => 
                    prevQuotations.map(q => q.id === quotationId ? {...q, status: newStatus} : q)
                );
                if(selectedQuotation && selectedQuotation.id === quotationId){
                    setSelectedQuotation(prev => ({...prev, status: newStatus}));
                }
            };

            const updateCartQuantity = (productId, newQuantity) => {
                setCart(prev => {
                    if (newQuantity <= 0) return prev.filter(item => item.product.id !== productId);
                    return prev.map(item => item.product.id === productId ? { ...item, quantity: newQuantity } : item);
                });
            };

            const removeFromCart = (productId) => setCart(prev => prev.filter(item => item.product.id !== productId));
            
            const addProduct = (product) => {
                const newProduct = { ...product, id: Date.now(), rating: 0, purchaseCount: 0, dateAdded: new Date().toISOString().split('T')[0] };
                setProducts(prev => [...prev, newProduct]);
                alert("Product listed successfully!");
                navigate('lenderProducts');
            };

            const value = { page, navigate, user, login, register, logout, updateUser, resetPassword, addContactSubmission, products, quotations, selectedProduct, selectedQuotation, cart, addToCart, updateCartQuantity, removeFromCart, wishlist, toggleWishlist, requestQuotation, addProduct, updateQuotationStatus };

            return <AppContext.Provider value={value}>{children}</AppContext.Provider>;
        };

        // --- CUSTOM HOOKS ---
        const useDebounce = (value, delay) => {
            const [debouncedValue, setDebouncedValue] = React.useState(value);
            React.useEffect(() => {
                const handler = setTimeout(() => setDebouncedValue(value), delay);
                return () => clearTimeout(handler);
            }, [value, delay]);
            return debouncedValue;
        };

        // --- HELPER COMPONENTS ---
        const PasswordStrengthMeter = ({ password }) => {
            const getStrength = () => {
                let score = 0;
                if (!password) return 0;
                if (password.length >= 8) score++;
                if (/[A-Z]/.test(password)) score++;
                if (/[0-9]/.test(password)) score++;
                if (/[^A-Za-z0-9]/.test(password)) score++;
                return score;
            };
            const strength = getStrength();
            const strengthText = ['Very Weak', 'Weak', 'Okay', 'Good', 'Strong'][strength];
            const color = ['bg-red-500', 'bg-orange-500', 'bg-yellow-500', 'bg-lime-500', 'bg-green-500'][strength];

            return (
                <div className="flex items-center gap-2 mt-1">
                    <div className="w-full bg-gray-600 rounded-full h-2">
                        <div className={`h-2 rounded-full ${color}`} style={{ width: `${(strength / 4) * 100}%` }}></div>
                    </div>
                    <span className="text-xs text-gray-300 w-20 text-right">{strengthText}</span>
                </div>
            );
        };

        const QuantityInput = ({ quantity, onDecrease, onIncrease }) => (
            <div className="flex items-center border border-gray-600 rounded-md">
                <button onClick={onDecrease} className="px-3 py-1 hover:bg-gray-700 transition-colors"><MinusIcon /></button>
                <span className="px-4">{quantity}</span>
                <button onClick={onIncrease} className="px-3 py-1 hover:bg-gray-700 transition-colors"><PlusIcon /></button>
            </div>
        );

        // --- AUTH PAGES ---
        const LoginPage = () => {
            const { login, navigate } = React.useContext(AppContext);
            const [email, setEmail] = React.useState('adam@example.com');
            const [password, setPassword] = React.useState('password123');
            const [role, setRole] = React.useState('customer');
            const [error, setError] = React.useState('');

            React.useEffect(() => {
                if (role === 'lender') {
                    setEmail('lender@example.com');
                    setPassword('password123');
                } else {
                    setEmail('adam@example.com');
                    setPassword('password123');
                }
            }, [role]);

            const handleSubmit = (e) => {
                e.preventDefault();
                setError('');
                const success = login(email, password, role);
                if (!success) {
                    setError('Invalid credentials or role. Please try again.');
                }
            };
            
            return (
                <div className="min-h-screen flex flex-col items-center justify-center p-4 bg-gray-900 text-white">
                    <div className="w-full max-w-md bg-gray-800 border border-gray-700 rounded-lg p-8 shadow-lg">
                        <div className="flex justify-between items-center mb-6">
                            <h1 className="text-2xl font-bold">Rental Management</h1>
                            <button onClick={() => navigate('shop')} className="px-4 py-2 rounded-md hover:bg-gray-700 transition-colors">Home</button>
                        </div>
                        <div className="mb-4">
                            <div className="flex bg-gray-700 rounded-md p-1">
                                <button onClick={() => setRole('customer')} className={`w-1/2 py-2 rounded ${role === 'customer' ? 'bg-indigo-600' : ''}`}>Customer</button>
                                <button onClick={() => setRole('lender')} className={`w-1/2 py-2 rounded ${role === 'lender' ? 'bg-indigo-600' : ''}`}>Lender</button>
                            </div>
                        </div>
                        <form onSubmit={handleSubmit}>
                            <div className="mb-4">
                                <label className="block mb-1 text-sm">Email</label>
                                <input type="email" value={email} onChange={e => setEmail(e.target.value)} placeholder="Enter your email" required className="w-full p-2 bg-gray-700 rounded border border-gray-600 focus:outline-none focus:ring-2 focus:ring-indigo-500" />
                            </div>
                            <div className="mb-6">
                                <label className="block mb-1 text-sm">Password</label>
                                <input type="password" value={password} onChange={e => setPassword(e.target.value)} placeholder="Enter your password" required className="w-full p-2 bg-gray-700 rounded border border-gray-600 focus:outline-none focus:ring-2 focus:ring-indigo-500" />
                            </div>
                            {error && <p className="text-red-500 text-sm mb-4">{error}</p>}
                            <button type="submit" className="w-full bg-indigo-600 py-3 rounded-lg hover:bg-indigo-500 transition-colors font-semibold">SIGN IN</button>
                        </form>
                        <div className="text-center mt-6 text-sm">
                            <p className="text-gray-400">
                                Don't have an account? <button onClick={() => navigate('register')} className="text-indigo-400 hover:underline">Register here</button>
                            </p>
                            <button onClick={() => navigate('forgotPassword')} className="text-indigo-400 hover:underline mt-2">Forgot username / password</button>
                        </div>
                    </div>
                </div>
            );
        };

        const RegisterPage = () => {
            const { register, navigate } = React.useContext(AppContext);
            const [name, setName] = React.useState('');
            const [email, setEmail] = React.useState('');
            const [phone, setPhone] = React.useState('');
            const [password, setPassword] = React.useState('');
            const [confirmPassword, setConfirmPassword] = React.useState('');
            const [showPassword, setShowPassword] = React.useState(false);
            const [error, setError] = React.useState('');

            const handleSubmit = (e) => {
                e.preventDefault();
                if (password !== confirmPassword) {
                    setError("Passwords do not match.");
                    return;
                }
                setError('');
                const success = register(name, email, phone, password);
                if (!success) {
                    setError('An account with this email already exists.');
                }
            };

            return (
                <div className="min-h-screen flex flex-col items-center justify-center p-4 bg-gray-900 text-white">
                    <div className="w-full max-w-md bg-gray-800 border border-gray-700 rounded-lg p-8 shadow-lg">
                        <div className="flex justify-between items-center mb-6">
                            <h1 className="text-2xl font-bold">Create Account</h1>
                            <button onClick={() => navigate('shop')} className="px-4 py-2 rounded-md hover:bg-gray-700 transition-colors">Home</button>
                        </div>
                        <form onSubmit={handleSubmit}>
                            <div className="mb-4"><label className="block mb-1 text-sm">Your Name</label><input type="text" value={name} onChange={e => setName(e.target.value)} placeholder="e.g. John Doe" required className="w-full p-2 bg-gray-700 rounded border border-gray-600 focus:outline-none focus:ring-2 focus:ring-indigo-500" /></div>
                            <div className="mb-4"><label className="block mb-1 text-sm">Your Email</label><input type="email" value={email} onChange={e => setEmail(e.target.value)} placeholder="e.g. john@example.com" required className="w-full p-2 bg-gray-700 rounded border border-gray-600 focus:outline-none focus:ring-2 focus:ring-indigo-500" /></div>
                            <div className="mb-4"><label className="block mb-1 text-sm">Your Phone</label><input type="tel" value={phone} onChange={e => setPhone(e.target.value)} placeholder="e.g. 9098980900" required className="w-full p-2 bg-gray-700 rounded border border-gray-600 focus:outline-none focus:ring-2 focus:ring-indigo-500" /></div>
                            <div className="mb-4">
                                <label className="block mb-1 text-sm">Password</label>
                                <div className="relative">
                                <input type={showPassword ? "text" : "password"} value={password} onChange={e => setPassword(e.target.value)} required className="w-full p-2 bg-gray-700 rounded border border-gray-600 focus:outline-none focus:ring-2 focus:ring-indigo-500" />
                                <button type="button" onClick={() => setShowPassword(!showPassword)} className="absolute inset-y-0 right-0 px-3 text-gray-400">{showPassword ? <EyeOffIcon /> : <EyeIcon />}</button>
                                </div>
                                <PasswordStrengthMeter password={password} />
                            </div>
                            <div className="mb-6"><label className="block mb-1 text-sm">Confirm Password</label><input type="password" value={confirmPassword} onChange={e => setConfirmPassword(e.target.value)} required className="w-full p-2 bg-gray-700 rounded border border-gray-600 focus:outline-none focus:ring-2 focus:ring-indigo-500" /></div>
                            {error && <p className="text-red-500 text-sm mb-4">{error}</p>}
                            <button type="submit" className="w-full bg-indigo-600 py-3 rounded-lg hover:bg-indigo-500 transition-colors font-semibold">REGISTER</button>
                        </form>
                        <div className="text-center mt-6 text-sm"><p className="text-gray-400">Already have an account? <button onClick={() => navigate('login')} className="text-indigo-400 hover:underline">Login</button></p></div>
                    </div>
                </div>
            );
        };
        
        const ForgotPasswordPage = () => {
            const { navigate, resetPassword } = React.useContext(AppContext);
            const [step, setStep] = React.useState(1); // 1: email, 2: otp, 3: reset
            const [email, setEmail] = React.useState('');
            const [error, setError] = React.useState('');
            const SIMULATED_OTP = '123456';

            const handleEmailSubmit = (e) => {
                e.preventDefault();
                const userExists = mockUsers.some(u => u.email === email);
                if (userExists) {
                    setError('');
                    alert(`An OTP has been sent to your email and phone. (Hint: it's ${SIMULATED_OTP})`);
                    setStep(2);
                } else {
                    setError('No account found with this email address.');
                }
            };

            const handleOtpSubmit = (e) => {
                e.preventDefault();
                const otp = e.target.elements.otp.value;
                if (otp === SIMULATED_OTP) {
                    setError('');
                    setStep(3);
                } else {
                    setError('Invalid OTP. Please try again.');
                }
            };
            
            const handleResetSubmit = (e) => {
                e.preventDefault();
                const newPassword = e.target.elements.newPassword.value;
                const confirmPassword = e.target.elements.confirmPassword.value;

                if(newPassword !== confirmPassword) {
                    setError('Passwords do not match.');
                    return;
                }
                
                const success = resetPassword(email, newPassword);
                if(success) {
                    alert('Password has been reset successfully. Please log in with your new password.');
                    navigate('login');
                } else {
                    setError('An unexpected error occurred. Please try again.');
                }
            };

            return (
                <div className="min-h-screen flex flex-col items-center justify-center p-4 bg-gray-900 text-white">
                    <div className="w-full max-w-md bg-gray-800 border border-gray-700 rounded-lg p-8 shadow-lg">
                        <h1 className="text-2xl font-bold mb-6">Forgot Password</h1>
                        {error && <p className="text-red-500 text-sm mb-4 bg-red-900/50 p-3 rounded-md">{error}</p>}
                        
                        {step === 1 && (
                            <form onSubmit={handleEmailSubmit}>
                                <p className="text-gray-400 mb-4 text-sm">Enter your email address and we'll send you an OTP to reset your password.</p>
                                <div className="mb-4">
                                    <label className="block mb-1 text-sm">Email</label>
                                    <input type="email" value={email} onChange={e => setEmail(e.target.value)} required className="w-full p-2 bg-gray-700 rounded border border-gray-600" />
                                </div>
                                <button type="submit" className="w-full bg-indigo-600 py-2 rounded-lg hover:bg-indigo-500">Send OTP</button>
                            </form>
                        )}

                        {step === 2 && (
                            <form onSubmit={handleOtpSubmit}>
                                <p className="text-gray-400 mb-4 text-sm">Please enter the 6-digit OTP sent to {email}.</p>
                                <div className="mb-4">
                                    <label className="block mb-1 text-sm">OTP</label>
                                    <input name="otp" type="text" maxLength="6" required className="w-full p-2 bg-gray-700 rounded border border-gray-600" />
                                </div>
                                <button type="submit" className="w-full bg-indigo-600 py-2 rounded-lg hover:bg-indigo-500">Verify OTP</button>
                            </form>
                        )}
                        
                        {step === 3 && (
                            <form onSubmit={handleResetSubmit}>
                                <p className="text-gray-400 mb-4 text-sm">Create a new password for your account.</p>
                                <div className="mb-4">
                                    <label className="block mb-1 text-sm">New Password</label>
                                    <input name="newPassword" type="password" required className="w-full p-2 bg-gray-700 rounded border border-gray-600" />
                                </div>
                                <div className="mb-4">
                                    <label className="block mb-1 text-sm">Confirm New Password</label>
                                    <input name="confirmPassword" type="password" required className="w-full p-2 bg-gray-700 rounded border border-gray-600" />
                                </div>
                                <button type="submit" className="w-full bg-indigo-600 py-2 rounded-lg hover:bg-indigo-500">Reset Password</button>
                            </form>
                        )}
                        <div className="text-center mt-4">
                             <button onClick={() => navigate('login')} className="text-sm text-indigo-400 hover:underline">Back to Login</button>
                        </div>
                    </div>
                </div>
            );
        };
        
        const EditProfilePage = () => {
            const { user, navigate, updateUser } = React.useContext(AppContext);
            
            if (!user) { // Protected route
                React.useEffect(() => navigate('login'), []);
                return null;
            }

            const [name, setName] = React.useState(user.name);
            const [phone, setPhone] = React.useState(user.phone || '');

            const handleDetailsSubmit = (e) => {
                e.preventDefault();
                updateUser({ name, phone }, "Personal details updated successfully!");
            };
            
            const handlePasswordSubmit = (e) => {
                e.preventDefault();
                const currentPassword = e.target.elements.currentPassword.value;
                const newPassword = e.target.elements.newPassword.value;
                const confirmNewPassword = e.target.elements.confirmNewPassword.value;

                if (newPassword !== confirmNewPassword) {
                    alert("New passwords do not match.");
                    return;
                }
                if (user.password === currentPassword) {
                    updateUser({ password: newPassword }, "Password changed successfully!");
                } else {
                    alert("Current password does not match.");
                }
            };

            return (
                <div className="p-8 max-w-4xl mx-auto">
                    <h1 className="text-3xl font-bold mb-8">Edit Profile</h1>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                        {/* Edit Details Form */}
                        <div className="bg-gray-800 p-6 rounded-lg border border-gray-700">
                            <h2 className="text-xl font-semibold mb-4">Personal Information</h2>
                            <form onSubmit={handleDetailsSubmit}>
                                <div className="mb-4"><label className="block text-sm mb-1">Full Name</label><input type="text" value={name} onChange={e => setName(e.target.value)} className="w-full p-2 bg-gray-700 rounded border border-gray-600" /></div>
                                <div className="mb-4"><label className="block text-sm mb-1">Email</label><input type="email" value={user.email} disabled className="w-full p-2 bg-gray-900 rounded border border-gray-700 cursor-not-allowed" /></div>
                                <div className="mb-6"><label className="block text-sm mb-1">Phone Number</label><input type="tel" value={phone} onChange={e => setPhone(e.target.value)} className="w-full p-2 bg-gray-700 rounded border border-gray-600" /></div>
                                <button type="submit" className="w-full bg-indigo-600 py-2 rounded-lg hover:bg-indigo-500 font-semibold">Update Details</button>
                            </form>
                        </div>

                        {/* Change Password Form */}
                        <div className="bg-gray-800 p-6 rounded-lg border border-gray-700">
                             <h2 className="text-xl font-semibold mb-4">Change Password</h2>
                             <form onSubmit={handlePasswordSubmit}>
                                <div className="mb-4"><label className="block text-sm mb-1">Current Password</label><input name="currentPassword" type="password" required className="w-full p-2 bg-gray-700 rounded border border-gray-600" /></div>
                                <div className="mb-4"><label className="block text-sm mb-1">New Password</label><input name="newPassword" type="password" required className="w-full p-2 bg-gray-700 rounded border border-gray-600" /></div>
                                <div className="mb-6"><label className="block text-sm mb-1">Confirm New Password</label><input name="confirmNewPassword" type="password" required className="w-full p-2 bg-gray-700 rounded border border-gray-600" /></div>
                                <button type="submit" className="w-full bg-gray-600 py-2 rounded-lg hover:bg-gray-500 font-semibold">Change Password</button>
                             </form>
                        </div>
                    </div>
                    <div className="text-center mt-8"><button onClick={() => navigate('shop')} className="text-indigo-400 hover:underline">Back to Shop</button></div>
                </div>
            );
        };
        
        const ContactUsPage = () => {
            const { navigate, addContactSubmission } = React.useContext(AppContext);
            
            const handleSubmit = (e) => {
                e.preventDefault();
                const submission = {
                    name: e.target.elements.name.value,
                    email: e.target.elements.email.value,
                    message: e.target.elements.message.value,
                    timestamp: new Date().toISOString(),
                };
                addContactSubmission(submission);
            };

            return (
                <div className="p-8 max-w-2xl mx-auto">
                    <h1 className="text-3xl font-bold mb-6 text-center">Contact Us</h1>
                    <p className="text-gray-400 text-center mb-8">Have a question or feedback? Fill out the form below and we'll get back to you.</p>
                    <div className="bg-gray-800 p-8 rounded-lg border border-gray-700">
                        <form onSubmit={handleSubmit}>
                            <div className="mb-4"><label className="block text-sm mb-1">Full Name</label><input name="name" type="text" required className="w-full p-2 bg-gray-700 rounded border border-gray-600" /></div>
                            <div className="mb-4"><label className="block text-sm mb-1">Email Address</label><input name="email" type="email" required className="w-full p-2 bg-gray-700 rounded border border-gray-600" /></div>
                            <div className="mb-6"><label className="block text-sm mb-1">Message</label><textarea name="message" rows="5" required className="w-full p-2 bg-gray-700 rounded border border-gray-600"></textarea></div>
                            <button type="submit" className="w-full bg-indigo-600 py-3 rounded-lg hover:bg-indigo-500 font-semibold">Submit Message</button>
                        </form>
                    </div>
                </div>
            );
        };

        // --- CORE APPLICATION PAGES ---
        const Header = () => {
            const { navigate, cart, user, logout } = React.useContext(AppContext);
            const [showProfileDropdown, setShowProfileDropdown] = React.useState(false);

            return (
                <header className="bg-gray-800 border-b border-gray-600 p-4 flex justify-between items-center text-white sticky top-0 z-50">
                    <div className="flex items-center gap-6">
                        <button onClick={() => navigate('shop')} className="p-2 rounded-md hover:bg-gray-700"><HomeIcon /></button>
                        <button onClick={() => navigate('shop')} className="px-4 py-2 rounded-md hover:bg-gray-700">Rental Shop</button>
                        {user && <button onClick={() => navigate('wishlist')} className="px-4 py-2 rounded-md hover:bg-gray-700">Wishlist</button>}
                        {user && <button onClick={() => navigate('customerOrders')} className="px-4 py-2 rounded-md hover:bg-gray-700">My Orders</button>}
                    </div>
                    <div className="flex items-center gap-6">
                        {user ? (
                            <React.Fragment>
                                <button onClick={() => navigate('reviewOrder')} className="relative p-2 rounded-md hover:bg-gray-700">
                                    <ShoppingCartIcon />
                                    {cart.length > 0 && <span className="absolute top-0 right-0 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">{cart.reduce((sum, item) => sum + item.quantity, 0)}</span>}
                                </button>
                                <div className="relative">
                                    <button onClick={() => setShowProfileDropdown(!showProfileDropdown)} className="flex items-center gap-2 p-2 rounded-md hover:bg-gray-700">
                                        <UserIcon />
                                        <span>{user?.name || 'Guest'}</span>
                                        <ChevronDownIcon />
                                    </button>
                                    {showProfileDropdown && (
                                        <div className="absolute right-0 mt-2 w-48 bg-gray-700 rounded-md shadow-lg py-1">
                                            <button className="w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-gray-600" onClick={() => {navigate('editProfile'); setShowProfileDropdown(false);}}>Edit Details</button>
                                            {user?.role === 'customer' && <button className="w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-gray-600" onClick={() => {alert("Switching to Lender role..."); setShowProfileDropdown(false);}}>Switch to Lender</button>}
                                            <button className="w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-gray-600" onClick={()=>{logout(); setShowProfileDropdown(false);}}>Logout</button>
                                        </div>
                                    )}
                                </div>
                            </React.Fragment>
                        ) : (
                            <button onClick={() => navigate('login')} className="px-4 py-2 bg-indigo-600 rounded-md hover:bg-indigo-500">Login / Register</button>
                        )}
                        <button onClick={() => navigate('contactUs')} className="px-4 py-2 bg-gray-600 rounded-md hover:bg-gray-500">Contact Us</button>
                    </div>
                </header>
            );
        };
        
        // --- LENDER COMPONENTS ---
        const LenderHeader = () => {
            const { page, navigate, user, logout } = React.useContext(AppContext);
            const [showProfileDropdown, setShowProfileDropdown] = React.useState(false);
            
            const NavButton = ({ target, label }) => (
                <button onClick={() => navigate(target)} className={`px-4 py-2 rounded-md ${page === target ? 'bg-indigo-600' : 'hover:bg-gray-700'}`}>{label}</button>
            );

            return (
                <header className="bg-gray-800 border-b border-gray-600 p-4 flex justify-between items-center text-white sticky top-0 z-50">
                    <div className="flex items-center gap-6">
                        <button onClick={() => navigate('lenderDashboard')} className="p-2 rounded-md hover:bg-gray-700"><HomeIcon /></button>
                        <NavButton target="lenderDashboard" label="Dashboard" />
                        <NavButton target="lenderRentals" label="Rental" />
                        <NavButton target="lenderOrders" label="Order" />
                        <NavButton target="lenderProducts" label="Products" />
                    </div>
                    <div className="flex items-center gap-6">
                        <div className="relative">
                            <button onClick={() => setShowProfileDropdown(!showProfileDropdown)} className="flex items-center gap-2 p-2 rounded-md hover:bg-gray-700">
                                <UserIcon />
                                <span>{user?.name || 'Lender'}</span>
                                <ChevronDownIcon />
                            </button>
                            {showProfileDropdown && (
                                <div className="absolute right-0 mt-2 w-48 bg-gray-700 rounded-md shadow-lg py-1">
                                    <button className="w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-gray-600" onClick={() => {navigate('editProfile'); setShowProfileDropdown(false);}}>Edit Details</button>
                                    <button className="w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-gray-600" onClick={()=>{logout(); setShowProfileDropdown(false);}}>Logout</button>
                                </div>
                            )}
                        </div>
                    </div>
                </header>
            );
        };

        const LenderDashboardPage = () => {
            const { quotations } = React.useContext(AppContext);
            
            const topCategories = [ { category: 'Electronics', ordered: 195, revenue: 29250 }, { category: 'Outdoor Gear', ordered: 390, revenue: 19500 }, { category: 'Sports Equipment', ordered: 95, revenue: 7600 }];
            const topProducts = [ { product: 'DSLR Camera', ordered: 120, revenue: 18000 }, { product: 'Camping Tent', ordered: 250, revenue: 12500 }, { product: 'E-Bike', ordered: 95, revenue: 7600 }];
            const topCustomers = [ { customer: 'Adam', ordered: 1, revenue: 157.50 }, { customer: 'Jane Doe', ordered: 2, revenue: 262.50 }];

            return (
                <div className="p-8">
                    <div className="flex justify-between items-center mb-6">
                        <div className="relative"><SearchIcon /><input type="text" placeholder="Search..." className="bg-gray-800 border border-gray-700 rounded-md pl-10 p-2 w-64" /></div>
                        <select className="bg-gray-800 border border-gray-700 rounded-md p-2"><option>Last 30 Days</option><option>Last 3 Months</option><option>Last 6 Months</option></select>
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div className="bg-gray-800 p-6 rounded-lg border border-gray-700 text-center"><p className="text-gray-400 text-sm">Quotations</p><p className="text-3xl font-bold">{quotations.length}</p></div>
                        <div className="bg-gray-800 p-6 rounded-lg border border-gray-700 text-center"><p className="text-gray-400 text-sm">Active Rentals</p><p className="text-3xl font-bold">{quotations.filter(q => q.status === 'PickedUp').length}</p></div>
                        <div className="bg-gray-800 p-6 rounded-lg border border-gray-700 text-center"><p className="text-gray-400 text-sm">Total Revenue</p><p className="text-3xl font-bold">₹10,599</p></div>
                    </div>
                    
                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <div className="bg-gray-800 p-6 rounded-lg border border-gray-700">
                            <h3 className="text-xl font-semibold mb-4">Top Product Categories</h3>
                            <table className="w-full text-left">
                                <thead><tr className="border-b border-gray-700"><th className="py-2">Category</th><th>Ordered</th><th>Revenue</th></tr></thead>
                                <tbody>{topCategories.map(c => <tr key={c.category} className="border-b border-gray-700"><td className="py-2">{c.category}</td><td>{c.ordered}</td><td>₹{c.revenue}</td></tr>)}</tbody>
                            </table>
                        </div>
                        <div className="bg-gray-800 p-6 rounded-lg border border-gray-700">
                            <h3 className="text-xl font-semibold mb-4">Top Products</h3>
                            <table className="w-full text-left">
                                <thead><tr className="border-b border-gray-700"><th className="py-2">Product</th><th>Ordered</th><th>Revenue</th></tr></thead>
                                <tbody>{topProducts.map(p => <tr key={p.product} className="border-b border-gray-700"><td className="py-2">{p.product}</td><td>{p.ordered}</td><td>₹{p.revenue}</td></tr>)}</tbody>
                            </table>
                        </div>
                        <div className="bg-gray-800 p-6 rounded-lg border border-gray-700 lg:col-span-2">
                            <h3 className="text-xl font-semibold mb-4">Top Customers</h3>
                            <table className="w-full text-left">
                                <thead><tr className="border-b border-gray-700"><th className="py-2">Customer</th><th>Ordered</th><th>Revenue</th></tr></thead>
                                <tbody>{topCustomers.map(c => <tr key={c.customer} className="border-b border-gray-700"><td className="py-2">{c.customer}</td><td>{c.ordered}</td><td>₹{c.revenue}</td></tr>)}</tbody>
                            </table>
                        </div>
                    </div>
                </div>
            );
        };
        
        const LenderProductsPage = () => {
             const { navigate, products } = React.useContext(AppContext);
             return (
                <div className="p-8">
                    <div className="flex justify-between items-center mb-6">
                        <h1 className="text-3xl font-bold">My Products</h1>
                        <button onClick={() => navigate('lenderAddProduct')} className="bg-indigo-600 px-4 py-2 rounded-md hover:bg-indigo-500">Add New Product</button>
                    </div>
                    <div className="bg-gray-800 rounded-lg border border-gray-700">
                        <table className="w-full text-left">
                            <thead className="border-b border-gray-700"><tr className="text-gray-400"><th className="p-4">Product Name</th><th>Category</th><th>Price/Day</th><th>Status</th><th>Actions</th></tr></thead>
                            <tbody>
                                {products.map(p => (
                                    <tr key={p.id} className="border-b border-gray-700">
                                        <td className="p-4">{p.name}</td><td>{p.category}</td><td>₹{p.price}</td><td><span className="bg-green-900 text-green-300 px-2 py-1 rounded-full text-xs">Active</span></td><td><button className="text-indigo-400">Edit</button></td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
             );
        };

        const LenderRentalsPage = () => {
            const { navigate, quotations } = React.useContext(AppContext);
            const activeQuotations = quotations.filter(q => q.status !== 'Returned');

            const StatusBadge = ({ status }) => {
                const colors = {
                    'Pending': 'bg-yellow-900 text-yellow-300',
                    'Quotation Sent': 'bg-blue-900 text-blue-300',
                    'Reserved': 'bg-green-900 text-green-300',
                    'Payment Request': 'bg-purple-900 text-purple-300',
                    'PickedUp': 'bg-teal-900 text-teal-300',
                };
                return <span className={`px-2 py-1 rounded-full text-xs ${colors[status] || 'bg-gray-700'}`}>{status}</span>
            };
            return (
                <div className="p-8">
                    <h1 className="text-3xl font-bold mb-6">Rental Quotations</h1>
                    <div className="bg-gray-800 rounded-lg border border-gray-700">
                         <table className="w-full text-left">
                            <thead className="border-b border-gray-700"><tr className="text-gray-400"><th className="p-4">Quotation ID</th><th>Customer</th><th>Total</th><th>Status</th><th>Actions</th></tr></thead>
                            <tbody>
                                {activeQuotations.length === 0 ? <tr><td colSpan="5" className="text-center p-8 text-gray-400">No active quotations.</td></tr> :
                                    activeQuotations.map(q => (
                                        <tr key={q.id} className="border-b border-gray-700">
                                            <td className="p-4">{q.id}</td><td>{q.customer.name}</td><td>₹{q.total.toFixed(2)}</td><td><StatusBadge status={q.status} /></td><td><button onClick={() => navigate('quotationDetail', q)} className="text-indigo-400">View</button></td>
                                        </tr>
                                    ))
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        };
        
        const LenderOrdersPage = () => {
            const { navigate, quotations } = React.useContext(AppContext);
            const completedOrders = quotations.filter(q => q.status === 'Returned');
             return (
                <div className="p-8">
                    <h1 className="text-3xl font-bold mb-6">Completed Orders</h1>
                    <div className="bg-gray-800 rounded-lg border border-gray-700">
                         <table className="w-full text-left">
                            <thead className="border-b border-gray-700"><tr className="text-gray-400"><th className="p-4">Order ID</th><th>Customer</th><th>Total</th><th>Status</th><th>Actions</th></tr></thead>
                            <tbody>
                                {completedOrders.length === 0 ? <tr><td colSpan="5" className="text-center p-8 text-gray-400">No completed orders.</td></tr> :
                                    completedOrders.map(q => (
                                        <tr key={q.id} className="border-b border-gray-700">
                                            <td className="p-4">{q.id}</td><td>{q.customer.name}</td><td>₹{q.total.toFixed(2)}</td><td><span className="bg-gray-700 text-gray-300 px-2 py-1 rounded-full text-xs">Returned</span></td><td><button onClick={() => navigate('quotationDetail', q)} className="text-indigo-400">View</button></td>
                                        </tr>
                                    ))
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
             );
        };
        
        const AddProductPage = () => {
            const { addProduct } = React.useContext(AppContext);
            const handleSubmit = (e) => {
                e.preventDefault();
                const formData = new FormData(e.target);
                const product = {
                    name: formData.get('name'),
                    category: formData.get('category'),
                    description: formData.get('description'),
                    imageUrl: formData.get('imageUrl'),
                    pickupAddress: formData.get('pickupAddress'),
                    priceList: {
                        hour: formData.get('price_hour'),
                        day: formData.get('price_day'),
                        week: formData.get('price_week'),
                        month: formData.get('price_month'),
                    },
                    price: formData.get('price_day'), // For display
                    terms: formData.get('terms'),
                };
                addProduct(product);
            };

            return (
                <div className="p-8 max-w-4xl mx-auto">
                    <h1 className="text-3xl font-bold mb-6">Add a New Product</h1>
                    <form onSubmit={handleSubmit} className="bg-gray-800 p-8 rounded-lg border border-gray-700 space-y-6">
                        <div><label className="block text-sm mb-1">Product Name</label><input name="name" type="text" required className="w-full p-2 bg-gray-700 rounded border border-gray-600" /></div>
                        <div><label className="block text-sm mb-1">Category</label><select name="category" required className="w-full p-2 bg-gray-700 rounded border border-gray-600">{categories.filter(c=>c!=='All').map(c => <option key={c}>{c}</option>)}</select></div>
                        <div><label className="block text-sm mb-1">Description</label><textarea name="description" rows="4" required className="w-full p-2 bg-gray-700 rounded border border-gray-600"></textarea></div>
                        <div><label className="block text-sm mb-1">Image URL</label><input name="imageUrl" type="url" required className="w-full p-2 bg-gray-700 rounded border border-gray-600" /></div>
                        <div><label className="block text-sm mb-1">Pickup/Return Address</label><textarea name="pickupAddress" rows="3" required className="w-full p-2 bg-gray-700 rounded border border-gray-600"></textarea></div>
                        
                        <fieldset className="border border-gray-700 p-4 rounded-lg">
                            <legend className="px-2 font-semibold">Price List</legend>
                            <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                <div><label className="block text-xs mb-1">Per Hour (₹)</label><input name="price_hour" type="number" required className="w-full p-2 bg-gray-700 rounded border border-gray-600" /></div>
                                <div><label className="block text-xs mb-1">Per Day (₹)</label><input name="price_day" type="number" required className="w-full p-2 bg-gray-700 rounded border border-gray-600" /></div>
                                <div><label className="block text-xs mb-1">Per Week (₹)</label><input name="price_week" type="number" required className="w-full p-2 bg-gray-700 rounded border border-gray-600" /></div>
                                <div><label className="block text-xs mb-1">Per Month (₹)</label><input name="price_month" type="number" required className="w-full p-2 bg-gray-700 rounded border border-gray-600" /></div>
                            </div>
                        </fieldset>
                        
                        <div><label className="block text-sm mb-1">Terms & Conditions</label><textarea name="terms" rows="3" required className="w-full p-2 bg-gray-700 rounded border border-gray-600"></textarea></div>
                        <button type="submit" className="w-full bg-indigo-600 py-3 rounded-lg hover:bg-indigo-500 font-semibold">List Product</button>
                    </form>
                </div>
            );
        };

        // --- CUSTOMER PAGES ---
        const ProductCard = ({ product }) => {
            const { user, navigate, addToCart, wishlist, toggleWishlist } = React.useContext(AppContext);
            const isInWishlist = user ? wishlist.some(p => p.id === product.id) : false;

            const handleAction = (action) => {
                if (!user) {
                    alert("Please log in to perform this action.");
                    navigate('login');
                } else {
                    action();
                }
            };

            return (
                <div className="bg-gray-800 border border-gray-700 rounded-lg p-4 flex flex-col justify-between">
                    <img src={product.imageUrl} alt={product.name} className="w-full h-48 object-cover rounded-md mb-4 cursor-pointer" onClick={() => navigate('productDetail', product)} />
                    <h3 className="text-lg font-semibold mb-2 cursor-pointer" onClick={() => navigate('productDetail', product)}>{product.name}</h3>
                    <div className="flex justify-between items-center mb-4">
                        <p className="text-xl font-bold text-indigo-400">₹{product.price}<span className="text-sm font-normal text-gray-400">/day</span></p>
                        <div className="flex items-center gap-1 text-yellow-400"><StarIcon filled={true} /> <span>{product.rating}</span></div>
                    </div>
                    <div className="flex items-center justify-between">
                        <button onClick={() => handleAction(() => addToCart({ product, quantity: 1 }))} className="bg-indigo-600 text-white px-4 py-2 rounded-md text-sm hover:bg-indigo-500">Add to Cart</button>
                        <button onClick={() => handleAction(() => toggleWishlist(product))} className={`p-2 rounded-full hover:bg-gray-700 ${isInWishlist ? 'text-red-500' : ''}`}><HeartIcon filled={isInWishlist} /></button>
                    </div>
                </div>
            );
        };

        const ProductListItem = ({ product }) => {
            const { user, navigate, addToCart, wishlist, toggleWishlist } = React.useContext(AppContext);
            const isInWishlist = user ? wishlist.some(p => p.id === product.id) : false;
             const handleAction = (action) => {
                if (!user) {
                    alert("Please log in to perform this action.");
                    navigate('login');
                } else {
                    action();
                }
            };

            return (
                <div className="bg-gray-800 border border-gray-700 rounded-lg p-4 flex items-center justify-between w-full">
                    <div className="flex items-center gap-4">
                        <img src={product.imageUrl} alt={product.name} className="w-24 h-24 object-cover rounded-md cursor-pointer" onClick={() => navigate('productDetail', product)} />
                        <div>
                            <h3 className="text-lg font-semibold mb-1 cursor-pointer" onClick={() => navigate('productDetail', product)}>{product.name}</h3>
                            <p className="text-gray-400 text-sm">{product.category}</p>
                        </div>
                    </div>
                    <p className="text-xl font-bold text-indigo-400">₹{product.price}<span className="text-sm font-normal text-gray-400">/day</span></p>
                    <div className="flex items-center gap-4">
                        <button onClick={() => handleAction(() => toggleWishlist(product))} className={`p-2 rounded-full hover:bg-gray-700 ${isInWishlist ? 'text-red-500' : ''}`}><HeartIcon filled={isInWishlist} /></button>
                        <button onClick={() => handleAction(() => addToCart({ product, quantity: 1 }))} className="bg-indigo-600 text-white px-6 py-2 rounded-md hover:bg-indigo-500">Add to Cart</button>
                    </div>
                </div>
            );
        };

        const RentalShopPage = () => {
            const { products } = React.useContext(AppContext);
            const [viewMode, setViewMode] = React.useState('grid');
            const [searchQuery, setSearchQuery] = React.useState('');
            const [sortOption, setSortOption] = React.useState('rating');
            const [currentPage, setCurrentPage] = React.useState(1);
            const [selectedCategory, setSelectedCategory] = React.useState('All');
            
            const debouncedSearchQuery = useDebounce(searchQuery, 300);
            const productsPerPage = viewMode === 'grid' ? 6 : 4;

            const filteredAndSortedProducts = React.useMemo(() => {
                let filtered = products;
                if (selectedCategory !== 'All') filtered = filtered.filter(p => p.category === selectedCategory);
                if (debouncedSearchQuery) filtered = filtered.filter(p => p.name.toLowerCase().includes(debouncedSearchQuery.toLowerCase()));
                return [...filtered].sort((a, b) => {
                    switch (sortOption) {
                        case 'rating': return b.rating - a.rating;
                        case 'purchases': return b.purchaseCount - a.purchaseCount;
                        case 'date': return new Date(b.dateAdded) - new Date(a.dateAdded);
                        case 'price-lh': return a.price - b.price;
                        case 'price-hl': return b.price - a.price;
                        default: return 0;
                    }
                });
            }, [debouncedSearchQuery, sortOption, selectedCategory, products]);
            
            const totalPages = Math.ceil(filteredAndSortedProducts.length / productsPerPage);
            const paginatedProducts = filteredAndSortedProducts.slice((currentPage - 1) * productsPerPage, currentPage * productsPerPage);

            return (
                <div className="p-8">
                    <div className="flex gap-2 mb-6 overflow-x-auto pb-2">{categories.map(cat => <button key={cat} onClick={() => { setSelectedCategory(cat); setCurrentPage(1); }} className={`flex-shrink-0 px-4 py-2 rounded-md ${selectedCategory === cat ? 'bg-indigo-600' : 'bg-gray-700 hover:bg-gray-600'}`}>{cat}</button>)}</div>
                    <div className="flex flex-col md:flex-row gap-8">
                        <aside className="w-full md:w-1/4">
                            <h3 className="text-xl font-semibold mb-4">Product Attributes</h3>
                            <div className="mb-6">
                                <h4 className="font-semibold mb-2">Colors</h4>
                                <div className="space-y-2">{colors.map(color => (<label key={color} className="flex items-center gap-2 cursor-pointer"><input type="checkbox" className="form-checkbox h-4 w-4 bg-gray-700 border-gray-600 text-indigo-600 focus:ring-indigo-500"/><span>{color}</span></label>))}</div>
                            </div>
                        </aside>
                        <main className="w-full md:w-3/4">
                            <div className="bg-gray-800 border border-gray-700 rounded-lg p-4 flex flex-col sm:flex-row items-center justify-between mb-6 gap-4">
                                <div className="relative w-full sm:w-auto"><SearchIcon /><input type="text" placeholder="Search..." value={searchQuery} onChange={e => setSearchQuery(e.target.value)} className="bg-gray-700 border-gray-600 rounded-md pl-10 p-2 w-full sm:w-64" /></div>
                                <div className="flex items-center gap-4">
                                    <select value={sortOption} onChange={e => setSortOption(e.target.value)} className="bg-gray-700 border-gray-600 rounded-md p-2">
                                        <option value="rating">Sort by: High Rating</option>
                                        <option value="purchases">Sort by: Popularity</option>
                                        <option value="price-lh">Sort by: Price Low to High</option>
                                        <option value="price-hl">Sort by: Price High to Low</option>
                                    </select>
                                    <div className="flex border border-gray-600 rounded-md">
                                        <button onClick={() => setViewMode('grid')} className={`p-2 ${viewMode === 'grid' ? 'bg-indigo-600' : ''}`}><GridIcon /></button>
                                        <button onClick={() => setViewMode('list')} className={`p-2 ${viewMode === 'list' ? 'bg-indigo-600' : ''}`}><ListIcon /></button>
                                    </div>
                                </div>
                            </div>
                            {viewMode === 'grid' ? (<div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">{paginatedProducts.map(p => <ProductCard key={p.id} product={p} />)}</div>) : (<div className="flex flex-col gap-4">{paginatedProducts.map(p => <ProductListItem key={p.id} product={p} />)}</div>)}
                            <div className="flex justify-center items-center mt-8 gap-2">{Array.from({ length: totalPages }, (_, i) => i + 1).map(page => (<button key={page} onClick={() => setCurrentPage(page)} className={`px-4 py-2 rounded-md ${currentPage === page ? 'bg-indigo-600' : 'bg-gray-700 hover:bg-gray-600'}`}>{page}</button>))}</div>
                        </main>
                    </div>
                </div>
            );
        };
        
        const ProductDetailPage = () => {
            const { user, selectedProduct: product, navigate, addToCart, wishlist, toggleWishlist } = React.useContext(AppContext);
            const [quantity, setQuantity] = React.useState(1);
            
            if (!product) return <div className="p-8">Product not found. <button onClick={() => navigate('shop')} className="text-indigo-400">Go back to shop.</button></div>;

            const isInWishlist = user ? wishlist.some(p => p.id === product.id) : false;
            
            const handleAction = (action) => {
                if (!user) {
                    alert("Please log in to perform this action.");
                    navigate('login');
                } else {
                    action();
                }
            };

            return (
                <div className="p-8">
                    <div className="text-sm text-gray-400 mb-6"><button onClick={() => navigate('shop')} className="hover:text-white">All Products</button> / <span>{product.name}</span></div>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-12">
                        <div>
                            <img src={product.imageUrl} alt={product.name} className="w-full h-auto object-cover rounded-lg shadow-lg mb-6"/>
                            <button onClick={() => handleAction(() => toggleWishlist(product))} className={`w-full py-3 rounded-lg border-2 flex items-center justify-center gap-2 ${isInWishlist ? 'bg-red-500 border-red-500' : 'border-gray-600 hover:bg-gray-700'}`}><HeartIcon filled={isInWishlist}/> Add to Wishlist</button>
                            <div className="mt-6"><h4 className="text-xl font-semibold mb-2">Product Description</h4><p className="text-gray-400">{product.description}</p></div>
                        </div>
                        <div>
                            <span className="text-indigo-400 font-semibold">{product.category}</span>
                            <h1 className="text-4xl font-bold my-2">{product.name}</h1>
                            <div className="flex items-center gap-2 mb-4"><StarIcon filled={true}/> <span className="text-lg">{product.rating} ({product.purchaseCount} rentals)</span></div>
                            <p className="text-3xl font-bold mb-4">₹{product.price} <span className="text-lg font-normal text-gray-400">/ per day</span></p>
                            <div className="grid grid-cols-2 gap-4 mb-4">
                                <div><label className="block text-sm mb-1">From:</label><input type="date" className="w-full p-2 bg-gray-700 rounded border border-gray-600"/></div>
                                <div><label className="block text-sm mb-1">To:</label><input type="date" className="w-full p-2 bg-gray-700 rounded border border-gray-600"/></div>
                            </div>
                            <div className="mb-4"><label className="block text-sm mb-1">Quantity:</label><QuantityInput quantity={quantity} onDecrease={() => setQuantity(q => Math.max(1, q - 1))} onIncrease={() => setQuantity(q => q + 1)} /></div>
                            <div className="flex gap-4">
                                <button onClick={() => handleAction(() => {addToCart({ product, quantity }); alert('Added to cart!')})} className="w-full bg-indigo-600 py-3 rounded-lg hover:bg-indigo-500 font-semibold">Add to Cart</button>
                                <button onClick={() => handleAction(() => { addToCart({ product, quantity }); navigate('reviewOrder'); })} className="w-full bg-green-600 py-3 rounded-lg hover:bg-green-500 font-semibold">Request to Buy</button>
                            </div>
                            <div className="mt-6"><h4 className="text-lg font-semibold">Terms & Conditions</h4><p className="text-sm text-gray-400">{product.terms}</p></div>
                        </div>
                    </div>
                </div>
            );
        };
        
        const ReviewOrderPage = () => {
            const { user, cart, updateCartQuantity, removeFromCart, navigate, requestQuotation } = React.useContext(AppContext);
            const [deliveryMethod, setDeliveryMethod] = React.useState('pickup');
            
            if (!user) { React.useEffect(() => navigate('login'), []); return null; }
            if (cart.length === 0) return <div className="p-8 text-center">Your cart is empty. <button onClick={() => navigate('shop')} className="text-indigo-400">Start renting!</button></div>;
            
            const subtotal = cart.reduce((sum, item) => sum + item.product.price * item.quantity, 0);
            const taxes = subtotal * TAX_RATE;
            const deliveryCharge = deliveryMethod === 'delivery' ? DELIVERY_CHARGE : 0;
            const total = subtotal + taxes + deliveryCharge;

            const handleRequestQuotation = (e) => {
                e.preventDefault();
                const formData = new FormData(e.target);
                const requestData = {
                    cart: cart,
                    total: total,
                    deliveryCharge: deliveryCharge,
                    deliveryMethod: deliveryMethod,
                    rentalPeriod: { from: formData.get('rentalFrom'), to: formData.get('rentalTo') },
                    deliveryAddress: formData.get('deliveryAddress'),
                    invoiceAddress: formData.get('invoiceAddress'),
                    pickupAddress: cart[0].product.pickupAddress, // Add pickup address to quotation data
                };
                requestQuotation(requestData);
            };

            return (
                <div className="p-8">
                    <h1 className="text-3xl font-bold mb-6">Request Quotation</h1>
                    <form onSubmit={handleRequestQuotation} className="flex flex-col lg:flex-row gap-8">
                        <div className="w-full lg:w-2/3 space-y-8">
                            <div>
                                <h2 className="text-2xl font-bold mb-4">1. Review Items</h2>
                                <div className="space-y-4">{cart.map(item => (<div key={item.product.id} className="flex items-center gap-4 bg-gray-800 p-4 rounded-lg border border-gray-700"><img src={item.product.imageUrl} alt={item.product.name} className="w-24 h-24 object-cover rounded" /><div className="flex-grow"><h3 className="font-semibold">{item.product.name}</h3><p className="text-indigo-400 font-bold">₹{item.product.price}</p></div><QuantityInput quantity={item.quantity} onDecrease={() => updateCartQuantity(item.product.id, item.quantity - 1)} onIncrease={() => updateCartQuantity(item.product.id, item.quantity + 1)} /><button onClick={() => removeFromCart(item.product.id)} className="p-2 text-gray-400 hover:text-red-500"><Trash2Icon /></button></div>))}</div>
                            </div>
                            <div>
                                <h2 className="text-2xl font-bold mb-4">2. Select Rental Period</h2>
                                <div className="bg-gray-800 p-6 rounded-lg border border-gray-700 grid grid-cols-2 gap-4">
                                    <div><label className="block text-sm mb-1">From:</label><input name="rentalFrom" type="date" required className="w-full p-2 bg-gray-700 rounded border border-gray-600"/></div>
                                    <div><label className="block text-sm mb-1">To:</label><input name="rentalTo" type="date" required className="w-full p-2 bg-gray-700 rounded border border-gray-600"/></div>
                                </div>
                            </div>
                             <div>
                                <h2 className="text-2xl font-bold mb-4">3. Delivery Method & Addresses</h2>
                                <div className="bg-gray-800 p-6 rounded-lg border border-gray-700 space-y-4">
                                    <div className="flex gap-4">
                                        <label><input type="radio" name="delivery" value="pickup" checked={deliveryMethod === 'pickup'} onChange={() => setDeliveryMethod('pickup')} className="form-radio mr-2"/>Self Pickup</label>
                                        <label><input type="radio" name="delivery" value="delivery" checked={deliveryMethod === 'delivery'} onChange={() => setDeliveryMethod('delivery')} className="form-radio mr-2"/>Home Delivery (+₹{DELIVERY_CHARGE})</label>
                                    </div>
                                    {deliveryMethod === 'delivery' ? (
                                        <React.Fragment>
                                            <div><label className="block text-sm mb-1">Delivery Address</label><textarea name="deliveryAddress" rows="3" required className="w-full p-2 bg-gray-700 rounded border border-gray-600"></textarea></div>
                                            <div><label className="block text-sm mb-1">Invoice Address</label><textarea name="invoiceAddress" rows="3" required className="w-full p-2 bg-gray-700 rounded border border-gray-600"></textarea></div>
                                        </React.Fragment>
                                    ) : (
                                        <React.Fragment>
                                            <div className="bg-gray-900 p-4 rounded-md"><p className="text-sm font-semibold">Pickup Address:</p><p className="text-gray-300">{cart[0].product.pickupAddress}</p></div>
                                            <div><label className="block text-sm mb-1">Invoice Address</label><textarea name="invoiceAddress" rows="3" required className="w-full p-2 bg-gray-700 rounded border border-gray-600"></textarea></div>
                                        </React.Fragment>
                                    )}
                                </div>
                             </div>
                        </div>
                        <div className="bg-gray-800 border border-gray-700 rounded-lg p-6 w-full lg:w-1/3 h-fit">
                            <h3 className="text-xl font-semibold mb-4">Summary</h3>
                            <div className="space-y-2 text-gray-300">
                                <div className="flex justify-between"><span>Sub Total</span><span>₹{subtotal.toFixed(2)}</span></div>
                                <div className="flex justify-between"><span>Taxes</span><span>₹{taxes.toFixed(2)}</span></div>
                                <div className="flex justify-between"><span>Delivery Charge</span><span>₹{deliveryCharge.toFixed(2)}</span></div>
                                <div className="border-t border-gray-600 my-2"></div>
                                <div className="flex justify-between text-white font-bold text-lg"><span>Total</span><span>₹{total.toFixed(2)}</span></div>
                            </div>
                            <button type="submit" className="w-full mt-6 bg-green-600 py-3 rounded-lg hover:bg-green-500 font-semibold">Confirm & Request Quotation</button>
                        </div>
                    </form>
                </div>
            );
        };
        
        const WishlistPage = () => {
            const { user, wishlist, navigate } = React.useContext(AppContext);
            if (!user) { React.useEffect(() => navigate('login'), []); return null; }
            if (wishlist.length === 0) return <div className="p-8 text-center">Your wishlist is empty. <button onClick={() => navigate('shop')} className="text-indigo-400">Explore products!</button></div>;
            return (
                <div className="p-8">
                    <h1 className="text-3xl font-bold mb-6">My Wishlist</h1>
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">{wishlist.map(p => <ProductCard key={p.id} product={p} />)}</div>
                </div>
            );
        };
        
        const CustomerOrdersPage = () => {
            const { user, navigate, quotations } = React.useContext(AppContext);
            const myQuotations = quotations.filter(q => q.customer.email === user.email);
            
            const StatusBadge = ({ status }) => {
                const statusMap = {
                    'Pending': { text: 'Quotation Sent', style: 'bg-yellow-900 text-yellow-300' },
                    'Quotation Sent': { text: 'Quotation Approved', style: 'bg-blue-900 text-blue-300' },
                    'Reserved': { text: 'Reserved', style: 'bg-green-900 text-green-300' },
                    'Payment Request': { text: 'Payment Request', style: 'bg-purple-900 text-purple-300' },
                    'PickedUp': { text: 'Picked Up', style: 'bg-teal-900 text-teal-300' },
                    'Returned': { text: 'Returned', style: 'bg-gray-700 text-gray-300' },
                };
                const display = statusMap[status] || { text: status, style: 'bg-gray-700' };
                return <span className={`px-2 py-1 rounded-full text-xs ${display.style}`}>{display.text}</span>
            };

            return (
                <div className="p-8">
                    <h1 className="text-3xl font-bold mb-6">My Orders & Quotations</h1>
                     <div className="bg-gray-800 rounded-lg border border-gray-700">
                         <table className="w-full text-left">
                            <thead className="border-b border-gray-700"><tr className="text-gray-400"><th className="p-4">Quotation ID</th><th>Date</th><th>Total</th><th>Status</th><th>Actions</th></tr></thead>
                            <tbody>
                                {myQuotations.length === 0 ? <tr><td colSpan="5" className="text-center p-8 text-gray-400">You have no orders or quotations.</td></tr> :
                                    myQuotations.map(q => (
                                        <tr key={q.id} className="border-b border-gray-700">
                                            <td className="p-4">{q.id}</td><td>{q.orderDate}</td><td>₹{q.total.toFixed(2)}</td><td><StatusBadge status={q.status} /></td>
                                            <td className="p-4">
                                                <button onClick={() => navigate('quotationDetail', q)} className="text-indigo-400">View</button>
                                                {q.status === 'Payment Request' && <button onClick={() => navigate('payment', q)} className="ml-4 bg-green-600 px-3 py-1 rounded-md text-sm">Pay Now</button>}
                                            </td>
                                        </tr>
                                    ))
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        };
        
        const QuotationDetailPage = () => {
            const { selectedQuotation: q, navigate, user, updateQuotationStatus } = React.useContext(AppContext);
            if (!q) return <div className="p-8">Quotation not found.</div>;

            const handlePrint = () => {
                alert("To save as a PDF, please change the 'Destination' in the upcoming print dialog to 'Save as PDF'.");
                window.print();
            };

            return (
                <div className="p-8">
                    <div className="max-w-4xl mx-auto bg-gray-800 p-8 rounded-lg border border-gray-700 text-white" id="printable-quotation">
                        <div className="flex justify-between items-start mb-8">
                            <div><h1 className="text-3xl font-bold">Quotation</h1><p className="text-indigo-400">{q.id}</p></div>
                            <div className="text-right"><p>Order Date: {q.orderDate}</p><p>Expiry Date: {q.expiryDate}</p></div>
                        </div>
                        <div className="grid grid-cols-2 gap-8 mb-8">
                            <div><h2 className="font-semibold mb-2">Customer Details</h2><p>{q.customer.name}</p><p>{q.customer.email}</p><p>{q.customer.phone}</p></div>
                            <div>
                                <h2 className="font-semibold mb-2">Addresses</h2>
                                {q.deliveryMethod === 'delivery' ? (
                                    <React.Fragment>
                                        <p className="font-bold text-sm">Delivery:</p><p className="text-gray-300">{q.deliveryAddress}</p>
                                        <p className="font-bold text-sm mt-2">Invoice:</p><p className="text-gray-300">{q.invoiceAddress}</p>
                                    </React.Fragment>
                                ) : (
                                    <React.Fragment>
                                        <p className="font-bold text-sm">Pickup Address:</p><p className="text-gray-300">{q.pickupAddress}</p>
                                        <p className="font-bold text-sm mt-2">Invoice:</p><p className="text-gray-300">{q.invoiceAddress}</p>
                                    </React.Fragment>
                                )}
                            </div>
                        </div>
                        <div className="mb-8"><h2 className="font-semibold mb-2">Rental Period</h2><p>{q.rentalPeriod.from} to {q.rentalPeriod.to}</p></div>
                        <div>
                            <h2 className="font-semibold mb-2">Product Summary</h2>
                            <table className="w-full text-left">
                                <thead className="bg-gray-900"><tr className="text-gray-300"><th className="p-2">Product</th><th>Qty</th><th>Unit Price</th><th>Total</th></tr></thead>
                                <tbody>{q.cart.map(item => <tr key={item.product.id} className="border-b border-gray-700"><td className="p-2">{item.product.name}</td><td>{item.quantity}</td><td>₹{item.product.price}</td><td>₹{item.product.price * item.quantity}</td></tr>)}</tbody>
                            </table>
                            <div className="w-full md:w-1/2 ml-auto mt-4 space-y-2 text-right">
                                <div className="flex justify-between"><span>Subtotal:</span><span>₹{((q.total - q.deliveryCharge) / (1 + TAX_RATE)).toFixed(2)}</span></div>
                                <div className="flex justify-between"><span>Taxes:</span><span>₹{(((q.total - q.deliveryCharge) / (1 + TAX_RATE)) * TAX_RATE).toFixed(2)}</span></div>
                                <div className="flex justify-between"><span>Delivery:</span><span>₹{q.deliveryCharge.toFixed(2)}</span></div>
                                <div className="flex justify-between font-bold text-lg border-t border-gray-600 pt-2"><span>Total:</span><span>₹{q.total.toFixed(2)}</span></div>
                            </div>
                        </div>
                    </div>
                    <div className="text-center mt-8 space-x-4">
                        {user.role === 'lender' && q.status === 'Pending' && <button onClick={() => updateQuotationStatus(q.id, 'Quotation Sent')} className="bg-green-600 px-6 py-2 rounded-md hover:bg-green-500">Approve Quotation</button>}
                        {user.role === 'customer' && q.status === 'Quotation Sent' && <button onClick={() => updateQuotationStatus(q.id, 'Reserved')} className="bg-blue-600 px-6 py-2 rounded-md hover:bg-blue-500">Accept Quotation</button>}
                        {user.role === 'lender' && q.status === 'Reserved' && <button onClick={() => updateQuotationStatus(q.id, 'Payment Request')} className="bg-purple-600 px-6 py-2 rounded-md hover:bg-purple-500">Request Payment</button>}
                        {user.role === 'lender' && q.status === 'PickedUp' && <button onClick={() => updateQuotationStatus(q.id, 'Returned')} className="bg-gray-600 px-6 py-2 rounded-md hover:bg-gray-500">Mark as Returned</button>}
                        <button onClick={handlePrint} className="bg-indigo-600 px-6 py-2 rounded-md hover:bg-indigo-500">Download / Print</button>
                        <button onClick={() => navigate(user.role === 'lender' ? 'lenderRentals' : 'customerOrders')} className="text-indigo-400 hover:underline">Back to List</button>
                    </div>
                </div>
            )
        };
        
        const PaymentPage = () => {
            const { selectedQuotation: q, navigate, updateQuotationStatus } = React.useContext(AppContext);
            const [paymentMethod, setPaymentMethod] = React.useState('credit_card');

            if (!q) {
                 React.useEffect(() => navigate('customerOrders'), []);
                 return <div className="p-8">Order not found. Redirecting...</div>;
            }

            const handlePayment = () => {
                alert("Payment successful!");
                updateQuotationStatus(q.id, 'PickedUp');
                navigate('customerOrders');
            };

            return (
                 <div className="p-8">
                    <h1 className="text-3xl font-bold mb-6">Confirm Payment for {q.id}</h1>
                     <div className="flex flex-col lg:flex-row gap-8">
                        <div className="w-full lg:w-2/3 bg-gray-800 p-6 rounded-lg border border-gray-700">
                            <h2 className="text-2xl font-bold mb-6">Choose a payment method</h2>
                            <div className="space-y-4">
                                <div className="p-3 border border-gray-600 rounded-lg"><label className="flex items-center gap-3"><input type="radio" name="payment" value="credit_card" checked={paymentMethod === 'credit_card'} onChange={e => setPaymentMethod(e.target.value)} className="form-radio bg-gray-900"/>Credit Card</label></div>
                                {paymentMethod === 'credit_card' && (<div className="p-4 bg-gray-900/50 rounded-lg ml-8 space-y-3"><input placeholder="Name on Card" className="w-full p-2 bg-gray-700 rounded border border-gray-600" /><input placeholder="Card Number" className="w-full p-2 bg-gray-700 rounded border border-gray-600" /><div className="flex gap-3"><input placeholder="Expiration Date (MM/YY)" className="w-1/2 p-2 bg-gray-700 rounded border border-gray-600" /><input placeholder="Security Code" className="w-1/2 p-2 bg-gray-700 rounded border border-gray-600" /></div></div>)}
                                <div className="p-3 border border-gray-600 rounded-lg"><label className="flex items-center gap-3"><input type="radio" name="payment" value="upi" checked={paymentMethod === 'upi'} onChange={e => setPaymentMethod(e.target.value)} className="form-radio bg-gray-900"/>UPI / QR Code</label></div>
                                <div className="p-3 border border-gray-600 rounded-lg"><label className="flex items-center gap-3"><input type="radio" name="payment" value="paypal" checked={paymentMethod === 'paypal'} onChange={e => setPaymentMethod(e.target.value)} className="form-radio bg-gray-900"/>Paypal</label></div>
                            </div>
                        </div>
                        <div className="bg-gray-800 border border-gray-700 rounded-lg p-6 w-full lg:w-1/3 h-fit">
                            <h3 className="text-xl font-semibold mb-4">Order Summary</h3>
                            <div className="space-y-2 text-gray-300">
                                <div className="flex justify-between"><span>Sub Total</span><span>₹{((q.total - q.deliveryCharge) / (1 + TAX_RATE)).toFixed(2)}</span></div>
                                <div className="flex justify-between"><span>Taxes</span><span>₹{(((q.total - q.deliveryCharge) / (1 + TAX_RATE)) * TAX_RATE).toFixed(2)}</span></div>
                                <div className="flex justify-between"><span>Delivery</span><span>₹{q.deliveryCharge.toFixed(2)}</span></div>
                                <div className="border-t border-gray-600 my-2"></div>
                                <div className="flex justify-between text-white font-bold text-lg"><span>Total</span><span>₹{q.total.toFixed(2)}</span></div>
                            </div>
                             <button onClick={handlePayment} className="w-full mt-6 bg-indigo-600 py-3 rounded-lg hover:bg-indigo-500 font-semibold">Pay Now</button>
                        </div>
                    </div>
                </div>
            )
        };

        // --- MAIN APP COMPONENT ---
        function App() {
            const { page, user } = React.useContext(AppContext);
            const publicPages = ['login', 'register', 'forgotPassword', 'shop', 'productDetail', 'contactUs'];
            
            const renderPage = () => {
                if(user?.role === 'lender') {
                    switch(page) {
                        case 'lenderDashboard': return <LenderDashboardPage />;
                        case 'lenderProducts': return <LenderProductsPage />;
                        case 'lenderAddProduct': return <AddProductPage />;
                        case 'lenderRentals': return <LenderRentalsPage />;
                        case 'lenderOrders': return <LenderOrdersPage />;
                        case 'editProfile': return <EditProfilePage />;
                        case 'quotationDetail': return <QuotationDetailPage />;
                        default: return <LenderDashboardPage />;
                    }
                }

                if (!user && !publicPages.includes(page)) {
                    return <LoginPage />;
                }
                
                switch (page) {
                    case 'shop': return <RentalShopPage />;
                    case 'productDetail': return <ProductDetailPage />;
                    case 'reviewOrder': return <ReviewOrderPage />;
                    case 'wishlist': return <WishlistPage />;
                    case 'customerOrders': return <CustomerOrdersPage />;
                    case 'quotationDetail': return <QuotationDetailPage />;
                    case 'editProfile': return <EditProfilePage />;
                    case 'contactUs': return <ContactUsPage />;
                    case 'forgotPassword': return <ForgotPasswordPage />;
                    case 'register': return <RegisterPage />;
                    case 'payment': return <PaymentPage />;
                    default: return <LoginPage />;
                }
            };
            
            return (
                <div className="bg-gray-900 text-white min-h-screen">
                    {user?.role === 'lender' ? <LenderHeader /> : <Header />}
                    <main>{renderPage()}</main>
                </div>
            );
        }

        // --- RENDER THE APP ---
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(
            <AppProvider>
                <App />
            </AppProvider>
        );

    </script>
</body>
</html>
